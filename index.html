<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GREENYX Weather</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 10px; background: #f0f8ff; font-size: 14px; }
    h2 { margin: 10px 0 5px; font-size: 16px; }
    .section { margin-bottom: 15px; }
    .timestamp { font-size: 12px; color: #555; margin-bottom: 5px; }
    .compact p { margin: 3px 0; line-height: 1.3; }
    img.icon { vertical-align: middle; height: 30px; }
  </style>
</head>
<body>
  <div class="timestamp" id="last-updated"></div>
  <div class="section compact" id="location-info"></div>
  <div class="section compact" id="current-weather"></div>
  <div class="section compact" id="forecast"></div>

  <script>
    const apiKey = 'b628f02897fc7f24a3175118197ab994';

    const updateTime = new Date().toLocaleString();
    document.getElementById('last-updated').textContent = `Last updated: ${updateTime}`;

    function getWeather(lat, lon, label = 'Your Location') {
      document.getElementById('location-info').innerHTML = `<p>📍 <strong>${label}</strong></p>`;

      fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`)
        .then(res => res.json())
        .then(data => {
          const w = data.weather?.[0] || {};
          const icon = `https://openweathermap.org/img/wn/${w.icon}@2x.png`;
          document.getElementById('current-weather').innerHTML = `
            <h2>🌡️ Now</h2>
            <p><img class="icon" src="${icon}" alt="${w.description}"> ${w.description}</p>
            <p>Temp: ${data.main.temp} °C (Feels like ${data.main.feels_like} °C)</p>
            <p>Humidity: ${data.main.humidity}% | Wind: ${data.wind.speed} m/s</p>
            <p>Clouds: ${data.clouds.all}% | Pressure: ${data.main.pressure} hPa</p>
          `;
        });

      fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`)
        .then(res => res.json())
        .then(data => {
          const forecastHTML = data.list.slice(0, 4).map(item => {
            const time = new Date(item.dt * 1000).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const w = item.weather?.[0] || {};
            const icon = `https://openweathermap.org/img/wn/${w.icon}@2x.png`;
            const rain = item.rain?.['3h'] || 0;
            return `<p><strong>${time}</strong> <img class="icon" src="${icon}" alt="${w.description}"> ${w.description}, ${item.main.temp} °C, 🌧️ ${rain} mm</p>`;
          }).join('');
          document.getElementById('forecast').innerHTML = `<h2>📅 Next Hours</h2>${forecastHTML}`;
        });
    }

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        pos => getWeather(pos.coords.latitude, pos.coords.longitude, 'Live Location'),
        () => getWeather(14.813, 121.045, 'San Jose del Monte')
      );
    } else {
      getWeather(14.813, 121.045, 'San Jose del Monte');
    }

    setInterval(() => location.reload(), 600000);
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GREENYX Weather Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 15px;
      background-color: #ffffff;
      font-size: 14px;
      margin: 0;
    }
    h1 {
      color: #2c3e50;
      margin-bottom: 5px;
    }
    .section {
      margin-bottom: 20px;
    }
    .timestamp {
      font-size: 12px;
      color: #555;
      margin-bottom: 10px;
    }
    .forecast-block {
      margin-bottom: 12px;
    }
    .weather-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 5px;
    }
    .weather-header img.icon {
      height: 80px;
      width: 80px;
    }
    .weather-details {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>ğŸŒ¾ Weather Dashboard</h1>
  <p class="timestamp" id="last-updated"></p>
  <div class="section" id="location-info"></div>
  <div class="section" id="current-weather"></div>
  <div class="section" id="forecast"></div>

  <script>
    const apiKey = 'b628f02897fc7f24a3175118197ab994';

    const updateTime = new Date().toLocaleString();
    document.getElementById('last-updated').textContent = `Last updated: ${updateTime}`;

    function getWeather(lat, lon, label = 'Your Location') {
      document.getElementById('location-info').innerHTML = `<p>ğŸ“ Showing weather for: <strong>${label}</strong></p>`;

      // ğŸŒ¡ï¸ Current Weather
      fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`)
        .then(res => res.json())
        .then(data => {
          const w = data.weather?.[0] || {};
          const icon = `https://openweathermap.org/img/wn/${w.icon}@4x.png`;
          const currentHTML = `
            <div class="forecast-block">
              <div class="weather-header">
                <img class="icon" src="${icon}" alt="${w.description}">
                <strong>${w.description}</strong>
              </div>
              <div class="weather-details">
                <span>ğŸŒ¡ï¸ Temp: ${data.main.temp}â€¯Â°C</span>
                <span>ğŸ’§ Humidity: ${data.main.humidity}%</span>
                <span>ğŸ’¨ Wind: ${data.wind.speed}â€¯m/s</span>
                <span>â˜ï¸ Clouds: ${data.clouds.all}%</span>
              </div>
            </div>
          `;
          document.getElementById('current-weather').innerHTML = currentHTML;
        });

      // ğŸ“… Forecast (Next 5 Days)
      fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`)
        .then(res => res.json())
        .then(data => {
          const dailyData = {};

          data.list.forEach(item => {
            const date = new Date(item.dt * 1000);
            const day = date.toLocaleDateString(undefined, { weekday: 'short', month: 'short', day: 'numeric' });

            if (!dailyData[day]) {
              dailyData[day] = {
                temps: [],
                winds: [],
                rains: [],
                icons: [],
                descriptions: [],
                middayIcon: null
              };
            }

            dailyData[day].temps.push(item.main.temp);
            dailyData[day].winds.push(item.wind.speed);
            dailyData[day].rains.push(item.rain?.['3h'] || 0);
            dailyData[day].icons.push(item.weather?.[0]?.icon);
            dailyData[day].descriptions.push(item.weather?.[0]?.description);

            const hour = date.getHours();
            if (hour === 12) {
              dailyData[day].middayIcon = item.weather?.[0]?.icon;
            }
          });

          const forecastHTML = Object.entries(dailyData).slice(0, 5).map(([day, values]) => {
            const avgTemp = (values.temps.reduce((a, b) => a + b, 0) / values.temps.length).toFixed(1);
            const avgWind = (values.winds.reduce((a, b) => a + b, 0) / values.winds.length).toFixed(1);
            const totalRain = values.rains.reduce((a, b) => a + b, 0).toFixed(1);
            const iconCode = values.middayIcon || values.icons[0];
            const iconURL = `https://openweathermap.org/img/wn/${iconCode}@4x.png`;
            const description = values.descriptions[Math.floor(values.descriptions.length / 2)];

            return `
              <div class="forecast-block">
                <div class="weather-header">
                  <img class="icon" src="${iconURL}" alt="${description}">
                  <strong>${day} â€“ ${description}</strong>
                </div>
                <div class="weather-details">
                  <span>ğŸŒ¡ï¸ Avg Temp: ${avgTemp}â€¯Â°C</span>
                  <span>ğŸŒ§ï¸ Total Rain: ${totalRain} mm</span>
                  <span>ğŸ’¨ Avg Wind: ${avgWind}â€¯m/s</span>
                </div>
              </div>
            `;
          }).join('');

          document.getElementById('forecast').innerHTML = `<h2>ğŸ“… 5-Day Forecast</h2>${forecastHTML}`;
        });
    }

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        pos => getWeather(pos.coords.latitude, pos.coords.longitude, 'Live Location'),
        () => getWeather(14.813, 121.045, 'San Jose del Monte')
      );
    } else {
      getWeather(14.813, 121.045, 'San Jose del Monte');
    }

    setInterval(() => location.reload(), 600000);
  </script>
</body>
</html>
